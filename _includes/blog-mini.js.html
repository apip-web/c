<div id="page-404" style="display:none;">
    <h1>404</h1>
    <p>Halaman tidak ditemukan.</p>
    <a href="/">Kembali ke Home</a>
</div>

<div id="posts" style="display:none;">
{% for post in site.posts %}
  <article class="post" data-url="{{ post.url | relative_url }}">
    <h2 class="post-title">
      <a href="{{ post.url | relative_url }}">{{ post.title }}</a>
    </h2>

    <div class="post-excerpt">
      {{ post.excerpt }}
    </div>

    <div class="post-content" style="display:none;">
      {% include post-meta.html post=post %}
    </div>
  </article>
{% endfor %}
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const btn        = document.getElementById('open-blog');
  const homepage   = document.querySelector('.homepage');
  const postsWrap  = document.getElementById('posts');
  const posts      = document.querySelectorAll('.post');

  // ── fungsi showHome, showList, showPost tetap sama seperti kode awal Anda ──

  // Router yang lebih toleran terhadap trailing slash
  function router() {
    let path = location.pathname.replace(/\/$/, '');  // hapus trailing slash

    if (path === '' || path === '/') {
      showHome();
      return;
    }

    // Halaman daftar blog (bisa diganti sesuai keinginan, misal '/posts')
    if (path === '/blog') {
      showList();
      return;
    }

    // Cari post (toleran trailing slash)
    const post = Array.from(posts).find(p => {
      let postPath = p.dataset.url.replace(/\/$/, '');
      return postPath === path;
    });

    if (post) {
      showPost(post.dataset.url);  // gunakan URL asli dari data-url
      return;
    }

    // Jika tidak ditemukan → tampilkan homepage atau 404
    showHome();
    // Alternatif: document.getElementById('page-404').style.display = '';
  }

  // 1. Tangkap SEMUA klik link internal
  document.addEventListener('click', function (e) {
    const a = e.target.closest('a');
    if (!a) return;

    const href = a.getAttribute('href');
    if (!href) return;

    // Lewati link yang jelas bukan navigasi internal
    if (
      href.startsWith('http') && !href.startsWith(location.origin) ||
      href.startsWith('#') ||
      href.startsWith('mailto:') ||
      href.startsWith('tel:') ||
      a.hasAttribute('target') && a.target !== '_self' ||
      a.hasAttribute('download')
    ) {
      return;
    }

    e.preventDefault();

    const targetPath = new URL(href, location.origin).pathname;
    history.pushState(null, '', targetPath);
    router();
  });

  // 2. Ganti tombol blog menjadi pushState (bukan hash)
  if (btn) {
    btn.addEventListener('click', () => {
      history.pushState(null, '', '/blog');
      router();
    });
  }

  // 3. Klik judul post (tetap dipertahankan, tapi router dipanggil manual)
  posts.forEach(post => {
    const link = post.querySelector('.post-title a');
    if (!link) return;
    link.addEventListener('click', e => {
      e.preventDefault();
      const url = post.dataset.url;
      history.pushState(null, '', url);
      router();           // penting: panggil router, bukan showPost langsung
    });
  });

  window.addEventListener('popstate', router);

  // Initial load
  router();
});
</script>
